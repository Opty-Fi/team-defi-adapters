{
  "title": "Invest Limitation",
  "description": "Test cases for invest limitation.",
  "vaults": [
    {
      "name": "Vault",
      "profile": "RP1",
      "stories": [
        {
          "description": "User should be able to deposit into a correct liquidity pool based on the current best strategy",
          "setActions": [
            {
              "contract": "erc20",
              "action": "approve(address,uint256)",
              "args": {
                "amount": {
                  "DAI": "2000000000000000000",
                  "USDC": "2000000",
                  "USDT": "2000000",
                  "SLP_WETH_USDC": "20000000000000"
                }
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": {
                  "DAI": "2000000000000000000",
                  "USDC": "2000000",
                  "USDT": "2000000",
                  "SLP_WETH_USDC": "20000000000000"
                }
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            }
          ],
          "getActions": [
            {
              "contract": "vault",
              "action": "balance()",
              "args": {},
              "expectedValue": {
                "DAI": "0",
                "USDC": "0",
                "USDT": "0",
                "SLP_WETH_USDC": "0"
              }
            },
            {
              "contract": "adapter",
              "action": "getLiquidityPoolTokenBalance(address,address,address)",
              "args": {},
              "expectedValue": {
                "DAI": ">",
                "USDC": ">",
                "USDT": ">",
                "SLP_WETH_USDC": ">"
              }
            }
          ]
        },
        {
          "description": "User should be able to withdraw from a correct liquidity pool based on the current best strategy",
          "setActions": [
            {
              "contract": "erc20",
              "action": "approve(address,uint256)",
              "args": {
                "amount": {
                  "DAI": "2000000000000000000",
                  "USDC": "2000000",
                  "USDT": "2000000",
                  "SLP_WETH_USDC": "20000000000000"
                }
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": {
                  "DAI": "2000000000000000000",
                  "USDC": "2000000",
                  "USDT": "2000000",
                  "SLP_WETH_USDC": "20000000000000"
                }
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "userWithdrawRebalance(uint256)",
              "args": {
                "amount": {
                  "DAI": "2000000000000000000",
                  "USDC": "2000000",
                  "USDT": "2000000",
                  "SLP_WETH_USDC": "20000000000000"
                }
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            }
          ],
          "getActions": [
            {
              "contract": "vault",
              "action": "balance()",
              "args": {},
              "expectedValue": {
                "DAI": "0",
                "USDC": "0",
                "USDT": "0",
                "SLP_WETH_USDC": "0"
              }
            },
            {
              "contract": "adapter",
              "action": "getLiquidityPoolTokenBalance(address,address,address)",
              "args": {},
              "expectedValue": {
                "DAI": "<",
                "USDC": "<",
                "USDT": "<",
                "SLP_WETH_USDC": "<"
              }
            }
          ]
        },
        {
          "description": "User should be able to deposit unlimited amount by default",
          "setActions": [
            {
              "contract": "erc20",
              "action": "approve(address,uint256)",
              "args": {
                "amount": {
                  "DAI": "2000000000000000000",
                  "USDC": "2000000",
                  "USDT": "2000000",
                  "SLP_WETH_USDC": "20000000000000"
                }
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": {
                  "DAI": "2000000000000000000",
                  "USDC": "2000000",
                  "USDT": "2000000",
                  "SLP_WETH_USDC": "20000000000000"
                }
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            }
          ],
          "getActions": [
            {
              "contract": "vault",
              "action": "balance()",
              "args": {},
              "expectedValue": {
                "DAI": "0",
                "USDC": "0",
                "USDT": "0",
                "SLP_WETH_USDC": "0"
              }
            },
            {
              "contract": "adapter",
              "action": "getLiquidityPoolTokenBalance(address,address,address)",
              "args": {},
              "expectedValue": {
                "DAI": ">",
                "USDC": ">",
                "USDT": ">",
                "SLP_WETH_USDC": ">"
              }
            }
          ]
        },
        {
          "description": "User shouldn't be able to deposit more than max deposit amount",
          "setActions": [
            {
              "contract": "adapter",
              "action": "setMaxDepositProtocolMode(uint8)",
              "args": {
                "type": 0
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            },
            {
              "contract": "adapter",
              "action": "setMaxDepositAmount(address,address,uint256)",
              "args": {
                "amount": {
                  "DAI": "500000000000000000",
                  "USDC": "500000",
                  "USDT": "500000",
                  "SLP_WETH_USDC": "5000000000000"
                }
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            },
            {
              "contract": "erc20",
              "action": "approve(address,uint256)",
              "args": {
                "amount": {
                  "DAI": "2000000000000000000",
                  "USDC": "2000000",
                  "USDT": "2000000",
                  "SLP_WETH_USDC": "20000000000000"
                }
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": {
                  "DAI": "2000000000000000000",
                  "USDC": "2000000",
                  "USDT": "2000000",
                  "SLP_WETH_USDC": "20000000000000"
                }
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            }
          ],
          "getActions": [
            {
              "contract": "vault",
              "action": "balance()",
              "args": {},
              "expectedValue": {
                "DAI": "1500000000000000000",
                "USDC": "1500000",
                "USDT": "1500000",
                "SLP_WETH_USDC": "15000000000000"
              }
            }
          ]
        },
        {
          "description": "User shouldn't be able to deposit any amount when max deposit amount = 0",
          "setActions": [
            {
              "contract": "adapter",
              "action": "setMaxDepositProtocolMode(uint8)",
              "args": {
                "type": 0
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            },
            {
              "contract": "adapter",
              "action": "setMaxDepositAmount(address,address,uint256)",
              "args": {
                "amount": {
                  "DAI": "0",
                  "USDC": "0",
                  "USDT": "0",
                  "SLP_WETH_USDC": "0"
                }
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            },
            {
              "contract": "erc20",
              "action": "approve(address,uint256)",
              "args": {
                "amount": {
                  "DAI": "2000000000000000000",
                  "USDC": "2000000",
                  "USDT": "2000000",
                  "SLP_WETH_USDC": "20000000000000"
                }
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            },
            {
              "contract": "vault",
              "action": "userDepositRebalance(uint256)",
              "args": {
                "amount": {
                  "DAI": "2000000000000000000",
                  "USDC": "2000000",
                  "USDT": "2000000",
                  "SLP_WETH_USDC": "20000000000000"
                }
              },
              "executer": "owner",
              "expect": "success",
              "message": ""
            }
          ],
          "getActions": [
            {
              "contract": "vault",
              "action": "balance()",
              "args": {},
              "expectedValue": {
                "DAI": "2000000000000000000",
                "USDC": "2000000",
                "USDT": "2000000",
                "SLP_WETH_USDC": "20000000000000"
              }
            }
          ]
        },
        {
          "description": "RiskOperator should be able to set max deposit mode",
          "setActions": [
            {
              "contract": "adapter",
              "action": "setMaxDepositProtocolMode(uint8)",
              "args": {
                "type": 0
              },
              "executer": "riskOperator",
              "expect": "success",
              "message": ""
            }
          ],
          "getActions": [
            {
              "contract": "adapter",
              "action": "maxDepositProtocolMode()",
              "args": {},
              "expectedValue": {
                "type": 0
              }
            }
          ]
        },
        {
          "description": "Non RiskOperator cannot set max deposit mode",
          "setActions": [
            {
              "contract": "adapter",
              "action": "setMaxDepositProtocolMode(uint8)",
              "args": {
                "type": 0
              },
              "executer": "admin",
              "expect": "fail",
              "message": "caller is not the riskOperator"
            }
          ],
          "getActions": []
        },

        {
          "description": "RiskOperator should be able to set max deposit amount",
          "setActions": [
            {
              "contract": "adapter",
              "action": "setMaxDepositAmount(address,address,uint256)",
              "args": {
                "amount": {
                  "DAI": "500000000000000000",
                  "USDC": "500000",
                  "USDT": "500000",
                  "SLP_WETH_USDC": "5000000000000"
                }
              },
              "executer": "riskOperator",
              "expect": "success",
              "message": ""
            }
          ],
          "getActions": [
            {
              "contract": "adapter",
              "action": "maxDepositAmount(address,address)",
              "args": {},
              "expectedValue": {
                "DAI": "500000000000000000",
                "USDC": "500000",
                "USDT": "500000",
                "SLP_WETH_USDC": "5000000000000"
              }
            }
          ]
        },

        {
          "description": "Non RiskOperator cannot set max deposit amount",
          "setActions": [
            {
              "contract": "adapter",
              "action": "setMaxDepositAmount(address,address,uint256)",
              "args": {
                "amount": { "DAI": "0", "USDC": "0", "USDT": "0", "SLP_WETH_USDC": "0" }
              },
              "executer": "admin",
              "expect": "fail",
              "message": "caller is not the riskOperator"
            }
          ],
          "getActions": []
        },
        {
          "description": "RiskOperator should be able to set max deposit pool percentage",
          "setActions": [
            {
              "contract": "adapter",
              "action": "setMaxDepositPoolPct(address,uint256)",
              "args": {
                "amount": { "DAI": "5", "USDC": "5", "USDT": "5", "SLP_WETH_USDC": "5" }
              },
              "executer": "riskOperator",
              "expect": "success",
              "message": ""
            }
          ],
          "getActions": [
            {
              "contract": "adapter",
              "action": "maxDepositPoolPct(address)",
              "args": {},
              "expectedValue": {
                "DAI": "5",
                "USDC": "5",
                "USDT": "5",
                "SLP_WETH_USDC": "5"
              }
            }
          ]
        },
        {
          "description": "Non RiskOperator cannot set max deposit pool percentage",
          "setActions": [
            {
              "contract": "adapter",
              "action": "setMaxDepositPoolPct(address,uint256)",
              "args": {
                "amount": { "DAI": "0", "USDC": "0", "USDT": "0", "SLP_WETH_USDC": "0" }
              },
              "executer": "admin",
              "expect": "fail",
              "message": "caller is not the riskOperator"
            }
          ],
          "getActions": []
        },
        {
          "description": "RiskOperator should be able to set max deposit protocol percentage",
          "setActions": [
            {
              "contract": "adapter",
              "action": "setMaxDepositProtocolPct(uint256)",
              "args": {
                "amount": { "DAI": "5", "USDC": "5", "USDT": "5", "SLP_WETH_USDC": "5" }
              },
              "executer": "riskOperator",
              "expect": "success",
              "message": ""
            }
          ],
          "getActions": [
            {
              "contract": "adapter",
              "action": "maxDepositProtocolPct()",
              "args": {},
              "expectedValue": {
                "DAI": "5",
                "USDC": "5",
                "USDT": "5",
                "SLP_WETH_USDC": "5"
              }
            }
          ]
        },
        {
          "description": "Non RiskOperator cannot set max deposit protocol percentage",
          "setActions": [
            {
              "contract": "adapter",
              "action": "setMaxDepositProtocolPct(uint256)",
              "args": {
                "amount": { "DAI": "0", "USDC": "0", "USDT": "0", "SLP_WETH_USDC": "0" }
              },
              "executer": "admin",
              "expect": "fail",
              "message": "caller is not the riskOperator"
            }
          ],
          "getActions": []
        }
      ]
    }
  ]
}
